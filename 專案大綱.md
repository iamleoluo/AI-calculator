# 📋 報告一：系統設計原則與核心理念（高層次）

---

## 一、專案核心理念

### 1.1 專案本質

這不是一個傳統的數值計算工具，而是一個 **展示 AI 數學推理能力的教學平台**。

**核心差異：**
- ❌ 傳統方式：用 NumPy/SciPy 計算 → 顯示結果（黑箱）
- ✅ 本專案：AI 展示完整推導過程 → 數值驗證 → 自我修正（透明）

**目標：**
- 讓學生看到數學推導的完整思考過程
- 證明 AI 具備深度數學物理知識
- 展示 AI 能自我驗證與修正錯誤
- 提供互動式學習體驗

---

## 二、核心設計原則

### 2.1 雙軌輸出原則（The Two Worlds Principle）

**原則說明：**

AI 的每一次輸出必須同時服務兩個不同的受眾：

```
┌─────────────────────────────────────────────────────┐
│  AI Response                                         │
│                                                      │
│  ┌──────────────────┐    ┌──────────────────┐      │
│  │  World 1:        │    │  World 2:        │      │
│  │  Human-Readable  │    │  Machine-Readable│      │
│  │                  │    │                  │      │
│  │  給人類看的       │    │  給電腦執行的     │      │
│  │  思考過程         │    │  精確程式碼       │      │
│  └──────────────────┘    └──────────────────┘      │
│         ↓                         ↓                 │
│    前端教學展示              後端數值驗證             │
└─────────────────────────────────────────────────────┘
```

**World 1: Human-Readable（人類世界）**
- **目的**：教學、解釋、理解
- **格式**：靈活、自由、自然語言
- **內容**：推理過程、數學步驟、LaTeX 公式、概念解釋
- **約束**：無嚴格約束，只要能讓學生理解

**World 2: Machine-Readable（機器世界）**
- **目的**：執行、驗證、計算
- **格式**：嚴格、固定、結構化
- **內容**：可執行程式碼、精確數值、固定格式的資料
- **約束**：必須 100% 可執行，格式不能有任何偏差

**為什麼需要分離？**
- 人類需要理解「為什麼」，機器需要知道「是什麼」
- 教學需要靈活性，驗證需要精確性
- 展示可以有冗餘，執行必須簡潔
- 解釋可以用比喻，程式碼必須字面

---

### 2.2 閉環驗證原則（Closed-Loop Verification）

**原則說明：**

系統不是「AI 說什麼就是什麼」，而是形成閉環驗證：

```
AI 推導 → 數值驗證 → 誤差分析 → 反饋修正 → 再次驗證
   ↑                                            ↓
   └──────────────── 誤差過大，重新計算 ──────────┘
```

**核心流程：**

1. **AI 推導階段**
   - AI 使用數學知識進行符號推導
   - 給出思考過程（給人看）
   - 給出可執行程式碼（給機器驗證）

2. **數值驗證階段**
   - 執行 AI 生成的程式碼
   - 使用獨立的數值方法計算
   - 比對兩者結果

3. **誤差判斷階段**
   - 計算相對誤差
   - 設定閾值（例如 1%）
   - 判斷是否可接受

4. **反饋修正階段**（如果誤差過大）
   - 構建錯誤報告
   - 指出可能的問題
   - 要求 AI 重新計算

**為什麼重要？**
- AI 可能犯錯（積分計算、符號簡化）
- 不能盲目信任 AI 的數學推導
- 提供自我修正能力，展示 AI 的學習過程
- 確保教學內容的正確性

---

### 2.3 漸進式學習原則（Progressive Learning）

**原則說明：**

系統設計支持從簡單到複雜的學習路徑：

```
Level 1: AI 示範
學生觀察 AI 如何推導

Level 2: 引導練習
學生嘗試計算，系統提示

Level 3: 獨立完成
學生獨立計算，系統驗證

Level 4: 對比學習
比較學生與 AI 的解法
```

**設計體現：**
- 提供多種學習模式（示範、練習、測驗）
- 分層提示系統（輕度→中度→詳細）
- 錯誤分析要具體指出問題點
- 視覺化幫助理解抽象概念

---

### 2.4 透明化原則（Transparency Principle）

**原則說明：**

與傳統黑箱工具不同，本系統強調透明：

**傳統計算工具：**
```
輸入 → [黑箱計算] → 輸出
```

**本系統：**
```
輸入 → [展示推理] → [展示計算] → [展示驗證] → 輸出
       ↓             ↓             ↓
    為什麼這樣做   如何計算      是否正確
```

**體現方式：**
- AI 展示每一步推理邏輯
- 顯示完整的數學公式推導
- 說明為什麼使用某個公式
- 展示驗證過程和誤差分析
- 如果錯誤，說明錯在哪裡

---

## 三、核心數據流設計

### 3.1 主數據流

```
┌────────────────────────────────────────────────────────┐
│  階段 1: 使用者輸入                                      │
└────────────────────────────────────────────────────────┘
         │
         │ LaTeX 公式 + 參數（週期、項數）
         ↓
┌────────────────────────────────────────────────────────┐
│  階段 2: Prompt 構建                                     │
│  - 定義任務（計算傅立葉級數）                            │
│  - 明確輸出格式（thinking + executable）                │
│  - 強調約束（executable 必須可執行）                     │
└────────────────────────────────────────────────────────┘
         │
         │ 結構化 Prompt
         ↓
┌────────────────────────────────────────────────────────┐
│  階段 3: AI 處理                                         │
│  Claude API 返回 JSON                                   │
└────────────────────────────────────────────────────────┘
         │
         │ JSON Response
         ↓
┌─────────────────────┬──────────────────────────────────┐
│  分支 A: 前端路徑    │  分支 B: 後端路徑                 │
│                     │                                  │
│  thinking_process   │  executable_code                 │
│       ↓             │       ↓                          │
│  解析與渲染         │  提取並執行                       │
│       ↓             │       ↓                          │
│  步驟展示           │  數值計算                         │
│  LaTeX 渲染         │       ↓                          │
│  程式碼展示         │  與 AI 結果比對                   │
│                     │       ↓                          │
│                     │  計算誤差                         │
│                     │       ↓                          │
│                     │  誤差檢查                         │
│                     │       ↓                          │
│                     │  小？ ─→ 完成 ✓                  │
│                     │  大？ ─→ 構建反饋 Prompt          │
│                     │             ↓                    │
│                     │      回到階段 2（迭代）           │
└─────────────────────┴──────────────────────────────────┘
```

### 3.2 迭代修正流程

```
第 N 次迭代:

1. 執行 AI 生成的程式碼
   ↓
2. 獲得數值結果: R_ai
   ↓
3. 使用獨立數值方法計算: R_numerical
   ↓
4. 計算誤差: error = |R_ai - R_numerical| / |R_numerical|
   ↓
5. 判斷:
   if error < threshold (例如 0.01):
       → 驗證通過，結束
   else:
       → 構建反饋 Prompt:
          "你的係數: [具體數值]
           數值驗證: [具體數值]
           誤差: X%
           可能問題: [分析]
           請重新計算，特別注意: [具體指導]"
       → 第 N+1 次迭代
```

---

## 四、為什麼這樣設計？

### 4.1 教育價值

**問題：** 學生只會用工具計算，不理解原理

**解決：**
- 展示完整推導過程
- 說明每一步的數學原理
- 視覺化抽象概念
- 互動式學習體驗

### 4.2 AI 能力展示

**問題：** 人們認為 AI 只是「文字接龍」，不會真正的數學

**解決：**
- 展示 AI 的數學推理能力
- 展示 AI 自我驗證與修正能力
- 證明 AI 可以作為教學工具

### 4.3 學習效果

**問題：** 傳統教學難以個性化，一對多難以照顧每個學生

**解決：**
- AI 可以針對每個學生的錯誤給出具體反饋
- 提供分層提示，適應不同程度
- 24/7 可用，不受時間地點限制

### 4.4 可擴展性

**問題：** 單一主題工具難以推廣

**解決：**
- 架構設計支援多種數學主題
  - 傅立葉級數 ✓
  - 泰勒展開
  - 拉普拉斯變換
  - 微分方程
- 模組化設計，易於添加新功能
- 數據流通用，不限於特定主題

---

## 五、成功的關鍵要素

### 5.1 Prompt Engineering

**這是整個系統的核心！**

Prompt 必須做到：
1. ✅ 明確定義兩種輸出（thinking + executable）
2. ✅ 對 executable 部分設定嚴格約束
3. ✅ 提供具體範例（Few-shot）
4. ✅ 清楚說明格式要求
5. ✅ 強調精確性的重要性

**失敗的 Prompt：**
```
"請計算這個函數的傅立葉級數"
→ AI 返回格式不一致，無法解析
```

**成功的 Prompt：**
```
"請計算...，返回 JSON 格式：
{
  'thinking': {...},
  'executable': {...}
}
executable 部分必須：
- 純 Python 程式碼
- 可直接 exec()
- 不要 markdown
[附上完整範例]"
→ AI 返回可預測的結構化數據
```

### 5.2 驗證機制

**為什麼重要：**
- AI 不是完美的，會犯錯
- 數學計算需要高精確度
- 教學內容錯誤會誤導學生

**如何實現：**
1. 雙重驗證（符號 + 數值）
2. 誤差閾值設定
3. 反饋迭代機制
4. 視覺化驗證（圖形對比）

### 5.3 使用者體驗

**關鍵點：**
1. 前端展示要清晰直觀
2. 步驟要可以逐步播放
3. 錯誤反饋要具體有用
4. 視覺化要互動式

---

## 六、系統邊界與限制

### 6.1 適用範圍

**適合：**
- 週期函數的傅立葉級數
- 可積分的函數
- 數學推導過程清晰的問題

**不太適合：**
- 高度複雜的特殊函數
- 沒有解析解的問題
- 需要大量數值計算的問題

### 6.2 技術限制

1. **AI Token 限制**
   - 太複雜的推導可能超過 token 限制
   - 需要分步處理

2. **執行安全性**
   - exec() AI 生成的程式碼有風險
   - 需要沙箱環境

3. **精確度限制**
   - 數值計算有浮點誤差
   - 需要合理設定閾值

---

## 七、總結

這個系統的核心理念可以總結為：

```
┌─────────────────────────────────────────────┐
│  透明化的 AI 數學教學系統                    │
│                                             │
│  原則 1: 雙軌輸出（人類 + 機器）             │
│  原則 2: 閉環驗證（推導 + 驗證 + 修正）      │
│  原則 3: 漸進學習（觀察 + 練習 + 獨立）      │
│  原則 4: 完全透明（展示所有推理過程）        │
│                                             │
│  目標: 讓 AI 成為可信賴的數學教學助手        │
└─────────────────────────────────────────────┘
```

**關鍵成功要素：**
1. 嚴謹的 Prompt 設計
2. 可靠的驗證機制
3. 清晰的數據流
4. 優秀的使用者體驗

---